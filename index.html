<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Tiny5&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
     <style>
     @font-face {
font-family: "Tiny5";
src: url("https://path-to-your-font-file.ttf") format("truetype"); /* Update this URL to your actual font file */
font-weight: 400;
font-style: normal;
}

 body {
        margin: 0;
        padding: 0;
        overflow: auto;
        text-align: center;
        font-family: "Tiny5", sans-serif;
    }

    .canvas-container {
        position: relative;
        display: inline-block;
        width: 100%;
        max-width: 100%;
    }

    canvas {
        align-items: center;
        display: block;
        margin: 0 auto;
        border: 3px solid black;
        width: 100%;
        height: 50vh;
        background-image: url('bg.png'); /* Update the URL with your actual background image */
        background-size: cover;
        background-position: center;
        border-radius: 50px;
    }
    /* CSS for volume controls */

    #startButton, #shopButton, #selectCharacterButton, #clearCacheButton, #highscoreButton, #pauseButton, #muteButton, #tweetScoreButton {
        position: absolute;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 20px;
        padding: 6px 15px;
        cursor: pointer;
        z-index: 2;
        border: none;
        color: white;
        border-radius: 30px;
        font-family: "Tiny5", sans-serif;
    }
     #totalPlayers {
    font-size: 24px; /* Adjust the font size as needed */
    text-align: center; /* Center align the text */
  }
    #tweetScoreButton { top: 15%; background-color: #fff; color: #000; }
    #startButton { top: 30%; background-color: #000; }
    #muteButton { top: 90%; background-color: #ff0000; }
    #pauseButton { top: 90%; background-color: #000; }
    #shopButton { top: 45%; background-color: #000; }
    #selectCharacterButton { top: 60%; background-color: #000; }
    #clearCacheButton { top: 75%; background-color: #ffec00; color: black; }
    #highscoreButton { top: 90%; background-color: #ff0000; }

    #scoreText, #coinText {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 24px;
        color: black;
        z-index: 1;
        font-family: "Tiny5", sans-serif;
    }

    #coinText { top: 50px; }

  @media (max-height: 600px) {
    canvas {
        height: 90vh;
        width: 100%;
        max-width: 100%;
        background-size: cover;
        background-position: center;
    }

    /* iPhone 6/7/8 in portrait */
    @media (max-device-width: 375px) and (max-height: 667px) and (-webkit-device-pixel-ratio: 2) {
        canvas {
            height: 60vh;  /* Adjusted height percentage */
            width: 100%;    /* Adjusted width percentage */
        }
    }

    /* iPhone 6/7/8 in landscape */
    @media (max-device-width: 667px) and (max-height: 375px) and (-webkit-device-pixel-ratio: 2) {
        canvas {
            height: 90vh;  /* Adjusted height percentage */
            width: 100%;
        }
    }
    /* Media query for smaller devices */
    @media (max-width: 768px) {
    canvas {
        width: 100%; /* 100% width for small devices */
        height: 60vh; /* Adjust height as needed */
    }
}
    /* iPhone 15 in landscape */
    @media (max-device-width: 926px) and (max-height: 428px) and (-webkit-device-pixel-ratio: 3) {
        canvas {
            height: 90vh;  /* Adjusted height percentage */
            width: 100%;    /* Adjusted width percentage */
        }
    }

    /* iPhone 11/12/13/14 in portrait */
    @media (max-device-width: 414px) and (max-height: 896px) and (-webkit-device-pixel-ratio: 2) {
        canvas {
            height: 70vh;  /* Adjusted height percentage */
            width: 90%;    /* Adjusted width percentage */
        }
    }

    /* iPhone 11/12/13/14 in landscape */
    @media (max-device-width: 896px) and (max-height: 414px) and (-webkit-device-pixel-ratio: 2) {
        canvas {
            height: 80vh;  /* Adjusted height percentage */
            width: 100%;    /* Adjusted width percentage */
        }
    }


        #startButton, #shopButton, #selectCharacterButton, #clearCacheButton, #highscoreButton {
            font-size: 16px;
            padding: 8px 16px;
        }

        #startButton { top: 30%; }
        #shopButton { top: 45%; }
        #selectCharacterButton { top: 60%; }
        #clearCacheButton { top: 75%; }
        #highscoreButton { top: 90%; }
    }

    .modal {
        display: none;
        position: fixed;
        z-index: 3;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        width: 80%;
        max-width: 400px;
        max-height: 80%;
        overflow-y: auto;
        color: #000;
        background-color: #fff;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        font-family: "Tiny5", sans-serif;
    }
    

    .modal img {
        width: 150px;
        height: 170px;
        margin: 10px;
        cursor: pointer;
    }

    .modal-close {
        position: absolute;
        top: 10px;
        right: 10px;
        cursor: pointer;
        font-size: 25px;
    }

    .character-container {
        max-height: 60vh;
        overflow-y: auto;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
    }

    .character-item {
        text-align: center;
    }

    .character-item img {
        cursor: pointer;
        width: 85px;
        height: 100px;
    }

    #highscoreModal {
        display: none;
        position: fixed;
        z-index: 3;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        width: 80%;
        max-width: 400px;
        max-height: 80%;
        overflow-y: auto;
        background-color: #fff;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        font-family: "Tiny5", sans-serif;
    }

    #highscoreModal img {
        width: 150px;
        height: 150px;
        margin: 10px;
        cursor: pointer;
    }

    #highscoreModal-close {
        position: absolute;
        top: 10px;
        right: 10px;
        cursor: pointer;
        font-size: 25px;
    }

    #highscoreList {}

    #usernameModal {
        display: none;
        position: fixed;
        z-index: 3;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        width: 80%;
        max-width: 400px;
        background-color: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        font-family: "Tiny5", sans-serif;
    }

    #usernameInput {
        width: 80%;
        padding: 10px;
        font-size: 16px;
        margin: 10px 0;
    }

    #saveUsernameButton {
        padding: 10px 20px;
        font-size: 16px;
        background-color: #000;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }
    
    





    </style>
</head>


<body>

    <div class="canvas-container">
        <canvas id="gameCanvas"></canvas>
        <button id="tweetScoreButton" style="display: none;">Tweet Score</button>
        <button id="startButton">Start Game</button>
        <button id="shopButton">Shop</button>
        <button id="selectCharacterButton">Select Character</button>
        <button id="highscoreButton" style="display: none;" disabled>Leaderboard</button>
        <button id="pauseButton" style="display:none;">Pause</button>
        <button id="muteButton">Mute</button>
        <button id="clearCacheButton">Clear Cache</button>
        
    </div>
    <p id="scoreText" style="display: none;">Score: 0</p>
    <p id="coinText" style="display: none;">Coins: 0</p>
    <form id="highscoreForm" style="display:none;">
    <input type="hidden" id="username" name="username">
    <input type="hidden" id="score" name="score">
</form>

<div id="usernameModal" class="modal">
    <div class="modal-content">
        <p>Please enter your username (max 12 characters):</p>
        <input type="text" id="usernameInput" maxlength="12">
        <button id="saveUsernameButton">Save</button>
        <div id="usernameValidationMessage"></div>
    </div>
</div>

    
   <div class="modal" id="shopModal">
        <span class="modal-close" id="shopModalClose">&times;</span>
        <h2>Shop</h2>
        <div id="coinCountDisplay">Coins: 0</div> <!-- Add this line -->
        <div class="character-container" id="characters">
           
       <div class="character-item" data-character="character2">
    <img src="char1.PNG" alt="Character 2">
    <p>25 Coins</p>
</div>
     



        </div>
    </div>

    <div class="modal" id="selectCharacterModal">
        <span class="modal-close" id="selectCharacterModalClose">&times;</span>
        <h2>Select Character</h2>
        <div class="character-container" id="purchasedCharacters"></div>
    </div>

<div class="modal" id="highscoreModal">
    <span class="modal-close" id="highscoreModalClose">&times;</span>
    <h2>Leaderboard</h2>
    <div id="highscoreList"></div>
</div>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        
        
        
        

        const turtleImage = new Image();
        turtleImage.src = 'char1.png';
        
        const backgroundImage = new Image();
        backgroundImage.src = 'bg.png'; 

        const coinImage = new Image();
        coinImage.src = 'coin.png';

        const characters = {
            character1: 'char1.png',
            
        };

        let selectedCharacter = localStorage.getItem('selectedCharacter') || 'character1';
        
       const turtle = {
            x: canvas.width / 4,
            y: canvas.height / 2 - 25,
            width: 50,
            height: 60,
            gravity: 0.19,
            lift: -5,
            velocity: 5
        };

        const bars = [];
        const barWidth = 50;
        let barGap = 400; 
        let barSpeed = 2;
        let score = 0;
        let gameRunning = false;
        let barCreationInterval;
        let speedUpdateInterval;

        const coins = [];
        const coinWidth = 24;
        const coinHeight = 24;
        let totalCoinsCollected = Number(localStorage.getItem('coins')) || 0;
        let purchasedCharacters = JSON.parse(localStorage.getItem('purchasedCharacters')) || [];

        let backgroundX = 0;

        function resizeCanvas() {
            canvas.width = canvas.clientWidth;
            canvas.height = canvas.clientHeight;
            barGap = 400;
        }

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

    let lastRotationAngle = 0; // Add a variable to store the last rotation angle

function drawTurtle() {
    // Calculate the rotation angle based on velocity
    let targetRotationAngle = Math.min(Math.max(turtle.velocity / 5, -2), 2) * 45;

    // Smooth the rotation by interpolating between the last angle and the target angle
    let dampingFactor = 0.2; // Increase the damping factor for more pronounced rotations
    lastRotationAngle += (targetRotationAngle - lastRotationAngle) * dampingFactor;

    ctx.save();
    ctx.translate(turtle.x + turtle.width / 2, turtle.y + turtle.height / 2); // Move to the turtle's center
    ctx.rotate((Math.PI / 180) * lastRotationAngle); // Rotate based on the smoothed angle
    ctx.drawImage(characterImages[selectedCharacter], -turtle.width / 2, -turtle.height / 2, turtle.width, turtle.height);
    ctx.restore();
}


        function drawCoin(coin) {
            ctx.drawImage(coinImage, coin.x, coin.y, coin.width, coin.height);
        }
        const coinSound = new Audio(''); // Replace with the correct path to your MP3 file
        const backgroundMusic = new Audio(''); // Replace with the correct path to your MP3 file
backgroundMusic.loop = true; // Loop s://flapthe background music
const gameOverSound = new Audio('');
const scoreSound = new Audio(''); // Replace with the correct path to your MP3 file

        function clearCanvas() {
            backgroundX -= barSpeed * 0.5; 
            if (backgroundX <= -canvas.width) {
                backgroundX = 0;
            }
            ctx.drawImage(backgroundImage, backgroundX, 0, canvas.width, canvas.height);
            ctx.drawImage(backgroundImage, backgroundX + canvas.width, 0, canvas.width, canvas.height);
        }
        
        

function createBars() {
    const minBarHeight = 50;
    const initialGap = 300; // Initial gap is moderate
    const scoreMultiplier = 0.05; // Moderate rate of gap decrease
    barGap = initialGap - score * scoreMultiplier;

    // Ensure the bar gap is within a reasonable range
    const gapAdjustment = Math.max(250 - score * 3, 150); // Moderate adjustment values
    const actualBarGap = Math.max(barGap - gapAdjustment, 150); // Ensuring a moderate minimum gap

    const isMobile = window.innerWidth <= 600;
    const horizontalGapAdjustment = isMobile ? 170 : 0; // Moderate adjustment for mobile
    const finalBarGap = actualBarGap - horizontalGapAdjustment;

    const minGapSize = 150; // Moderate minimum gap size
    const gapSize = Math.max(minGapSize, finalBarGap);

    // Calculate the gap position
    const maxBarHeight = canvas.height - barGap - minBarHeight;
    const gapOpeningPosition = Math.random() * (maxBarHeight - minBarHeight) + minBarHeight;
    const gapPosition = Math.random() * (canvas.height - gapSize);

    // Create the bars
    bars.push({
        x: canvas.width,
        y: 0,
        width: barWidth,
        height: gapPosition,
        scored: false
    });
    bars.push({
        x: canvas.width,
        y: gapPosition + gapSize,
        width: barWidth,
        height: canvas.height - gapPosition - gapSize,
        scored: false
    });




    if (Math.random() < 0.3) {
        const coinY = gapPosition + (gapSize - coinHeight) / 2;
        const coinX = canvas.width + (barWidth / 2) - (coinWidth / 2); // Center the coin horizontally
        coins.push({
            x: coinX,
            y: coinY,
            width: coinWidth,
            height: coinHeight,
            collected: false
        });
    }
}

        function drawBars() {
            bars.forEach(bar => {
                ctx.fillStyle = 'green';
                ctx.fillRect(bar.x, bar.y, bar.width, bar.height);
            });
        }
                       document.getElementById('clearCacheButton').addEventListener('click', function() {
    // Display confirmation dialog
    if (confirm("Are you sure you want to clear the cache?")) {
        // Clear the cache if user confirms
        localStorage.clear();
        alert('All progress has been reset!');
        // Optionally, refresh the page to apply changes
        location.reload();
    }
});


        function drawCoins() {
            coins.forEach(coin => {
                if (!coin.collected) {
                    drawCoin(coin);
                }
            });
        }

        function updateSpeed() {
            barSpeed += 0.1;
        }

        const characterImages = {};
        function preloadCharacterImages() {
            for (const key in characters) {
                const img = new Image();
                img.src = characters[key];
                characterImages[key] = img;
            }
        }

        preloadCharacterImages();

        function updateBars() {
            bars.forEach(bar => {
                bar.x -= barSpeed;
            });

            if (bars.length && bars[0].x + barWidth < 0) {
                bars.splice(0, 2);
            }
        }

        function updateCoins() {
            coins.forEach(coin => {
                coin.x -= barSpeed;
            });

            if (coins.length && coins[0].x + coinWidth < 0) {
                coins.shift();
            }
        }
        document.addEventListener('keydown', function(event) {
    if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', ' '].includes(event.key)) {
        event.preventDefault();
    }
});





function detectCollision() {
    const turtleLeft = turtle.x + turtle.width * 0.2; // Left side of the turtle (20% inward)
    const turtleRight = turtle.x + turtle.width * 0.8; // Right side of the turtle (80% inward)
    const turtleTop = turtle.y + turtle.height * 0.33; // Top side of the turtle (25% inward)
    const turtleBottom = turtle.y + turtle.height * 0.63; // Bottom side of the turtle (75% inward)

    // Check for canvas top or bottom collision
    if (turtleTop <= 0 || turtleBottom >= canvas.height) {
        return true; // Collision detected
    }

    // Check for bar collision
    for (let i = 0; i < bars.length; i++) {
        const barLeft = bars[i].x;
        const barRight = bars[i].x + barWidth;
        const barTop = bars[i].y;
        const barBottom = bars[i].y + bars[i].height;

        // Check for top and bottom collisions
        if (turtleBottom > barTop && turtleTop < barBottom) {
            // Check if left or right sides overlap within the bars
            if (turtleRight > barLeft && turtleLeft < barRight) {
                return true; // Collision detected
            }
        }
    }

    return false; // No collision detected
}

        function detectCoinCollection() {
    for (let i = 0; i < coins.length; i++) {
        if (!coins[i].collected &&
            turtle.x < coins[i].x + coinWidth &&
            turtle.x + turtle.width > coins[i].x &&
            turtle.y < coins[i].y + coinHeight &&
            turtle.y + turtle.height > coins[i].y) {
            coins[i].collected = true;
            totalCoinsCollected++;
            coinSound.play(); // Play sound effect
            updateCoinCount();
            coins.splice(i, 1);
            i--;
        }
    }
}


function update() {
    if (!gameRunning) return;

    clearCanvas();
    drawTurtle();
    drawBars();
    drawCoins();
    turtle.velocity += turtle.gravity;
    turtle.y += turtle.velocity;
    updateBars();
    updateCoins();

    if (detectCollision()) {
        gameOver();
        return; // Exit the update loop if a collision is detected
    }

    detectCoinCollection();

    for (let i = 0; i < bars.length; i += 2) {
        if (turtle.x > bars[i].x + barWidth && !bars[i].scored) {
            score++;
            bars[i].scored = true;
            updateScore();
        }
    }

    requestAnimationFrame(update);
}

let previousScore = 0;
       // Function to update the score and play the sound effect
function updateScore() {
    if (score > previousScore) {
        scoreSound.play(); // Play score sound effect
    }
    previousScore = score;
    document.getElementById('scoreText').textContent = 'Score: ' + score;
}
        function updateCoinCount() {
            document.getElementById('coinText').textContent = 'Coins: ' + totalCoinsCollected;
            localStorage.setItem('coins', totalCoinsCollected);
        }

        function updatePurchasedCharacters() {
            const purchasedContainer = document.getElementById('purchasedCharacters');
            purchasedContainer.innerHTML = '';

            purchasedCharacters.forEach(character => {
                const characterItem = document.createElement('div');
                characterItem.className = 'character-item';
                characterItem.setAttribute('data-character', character);

                const characterImg = document.createElement('img');
                characterImg.src = characters[character];
                characterImg.alt = character;

                characterItem.appendChild(characterImg);
                purchasedContainer.appendChild(characterItem);
            });

            localStorage.setItem('purchasedCharacters', JSON.stringify(purchasedCharacters));
        }

        function jump() {
            turtle.velocity = turtle.lift;
        }

        function keyDown(e) {
    if (e.key === ' ' || e.code === 'Space') {
        jump();
        jumpSound.play(); // Play jump sound effect
    }
    
}

function touchStart(event) {
    const rect = canvas.getBoundingClientRect();
    const touchX = event.touches[0].clientX - rect.left;
    const touchY = event.touches[0].clientY - rect.top;

    if (touchX >= 0 && touchX <= canvas.width && touchY >= 0 && touchY <= canvas.height) {
        jump();
        jumpSound.play(); // Play jump sound effect
    }
}
document.addEventListener('keydown', keyDown);
canvas.addEventListener('touchstart', touchStart);

let barSpeedIncreaseInterval;
function startGame() {
    const username = localStorage.getItem('username');
    if (!username) {
        document.getElementById('usernameModal').style.display = 'block';
        return; // Prevent starting the game if username is not set
    }

    gameRunning = true;
    score = 0;
    previousScore = 0; // Reset previousScore when the game starts
    turtle.x = canvas.width / 4;
    turtle.y = canvas.height / 2 - 25;
    turtle.velocity = 0;
    bars.length = 0;
    coins.length = 0;
    barSpeed = 2;
    document.getElementById('clearCacheButton').style.display = 'none';
    document.getElementById('startButton').style.display = 'none';
    document.getElementById('tweetScoreButton').style.display = 'none';
    document.getElementById('muteButton').style.display = 'none';
    document.getElementById('shopButton').style.display = 'none';
    document.getElementById('selectCharacterButton').style.display = 'none';
    document.getElementById('highscoreButton').style.display = 'none'; // Hide highscore button
    document.getElementById('scoreText').style.display = 'block';
    document.getElementById('coinText').style.display = 'block';
    document.getElementById('pauseButton').style.display = 'block'; // Show the pause button
    updateScore();
    updateCoinCount();
    backgroundMusic.play(); // Start playing background music
    update();
    barCreationInterval = setInterval(createBars, 2000);
    barSpeedIncreaseInterval = setInterval(increaseBarSpeed, 5000);
    speedUpdateInterval = setInterval(updateSpeed, 5000);
}
function increaseBarSpeed() {
    barSpeed += 0.2; // Pas de snelheidstoename aan zoals gewenst
}

document.querySelectorAll('button').forEach(button => {
    button.addEventListener('click', (event) => {
        event.stopPropagation(); // Prevent the canvas click event when clicking on buttons
    });
});

// Add the event listener for the tweet score button
document.getElementById('tweetScoreButton').addEventListener('click', tweetScore);

// Function to tweet the score
function tweetScore() {
    const tweetText = `I reached a score of ${score} in Bonkey Bird! Can you beat my score? `;
    const tweetUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(tweetText)}`;
    window.open(tweetUrl, '_blank');
}

// Show the tweet score button when game over
function gameOver() {
    gameRunning = false;
    clearInterval(barCreationInterval);
    clearInterval(speedUpdateInterval);
    clearInterval(barSpeedIncreaseInterval);
    backgroundMusic.pause();
    backgroundMusic.currentTime = 0;
    gameOverSound.play();
    updateHighscore();
    document.getElementById('startButton').style.display = 'block';
    document.getElementById('tweetScoreButton').style.display = 'block';
    document.getElementById('clearCacheButton').style.display = 'block';
    document.getElementById('shopButton').style.display = 'block';
    document.getElementById('muteButton').style.display = 'block';
    document.getElementById('selectCharacterButton').style.display = 'block';
    document.getElementById('highscoreButton').style.display = 'none';
    document.getElementById('pauseButton').style.display = 'none'; // Hide the pause button on game over
    document.getElementById('tweetScoreButton').style.display = 'block'; // Show tweet score button
    document.getElementById('startButton').textContent = 'Restart Game';
    localStorage.setItem('score', score);

    const username = localStorage.getItem('username');
    submitHighscore(username, score); // Submit the highscore
}

function submitHighscore(username, score) {
    fetch('/wp-content/themes/hello-elementor/save_score.php', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: `username=${encodeURIComponent(username)}&score=${encodeURIComponent(score)}`
    })
    .then(response => response.text())
    .then(data => {
        console.log('Highscore submitted:', data);
        // Optionally, you can fetch the updated leaderboard after submission
        fetchHighscores();
    })
    .catch(error => {
        console.error('Error submitting highscore:', error);
    });
}


function fetchHighscores() {
    fetch('/wp-content/themes/hello-elementor/get_scores.php')
        .then(response => response.json())
        .then(data => {
            const scores = data.scores;
            const totalPlayers = data.total_players;

            const highscoreList = document.getElementById('highscoreList');
            highscoreList.innerHTML = '';

            const customHighscoreList = document.getElementById('customHighscoreContainer');
            customHighscoreList.innerHTML = ''; // Clear previous content

            scores.forEach((score, index) => {
                const scoreItem = document.createElement('p');
                scoreItem.textContent = `${index + 1}. ${score.username}: ${score.score}`;

                if (index === 0) {
                    const crownIcon = document.createElement('img');
                    crownIcon.src = '';
                    crownIcon.alt = 'crown';
                    crownIcon.style.width = '22px';
                    crownIcon.style.height = '22px';
                    crownIcon.style.verticalAlign = 'middle';
                    scoreItem.appendChild(crownIcon);
                }

                highscoreList.appendChild(scoreItem);
                customHighscoreList.appendChild(scoreItem.cloneNode(true)); // Append to custom highscore list
            });

            const totalPlayersElement = document.getElementById('totalPlayers');
            totalPlayersElement.textContent = `Total Players: ${totalPlayers}`;
        })
        .catch(error => {
            console.error('Error fetching highscores:', error);
        });
}

document.getElementById('highscoreButton').addEventListener('click', () => {
    fetchHighscores();
    updateCustomHighscore();
    document.getElementById('highscoreModal').style.display = 'block';
});

function updateCustomHighscore() {
    const highscoreList = document.getElementById('customHighscoreContainer');
    highscoreList.innerHTML = '';
    fetchHighscores();
}






function openShop() {
    const shopModal = document.getElementById('shopModal');
    const characterContainer = document.getElementById('characters');
    const coinCountDisplay = document.getElementById('coinCountDisplay'); // Get the coin count display element

    // Update the coin count display with the current number of coins
    coinCountDisplay.textContent = 'Coins: ' + totalCoinsCollected;

    characterContainer.querySelectorAll('.character-item').forEach(item => {
        const character = item.getAttribute('data-character');
        if (purchasedCharacters.includes(character)) {
            item.style.display = 'none';
        } else {
            item.style.display = 'block';
        }
    });

    shopModal.style.display = 'block';
}

        function closeShop() {
            document.getElementById('shopModal').style.display = 'none';
        }

        function openSelectCharacter() {
            document.getElementById('selectCharacterModal').style.display = 'block';
        }

        function closeSelectCharacter() {
            document.getElementById('selectCharacterModal').style.display = 'none';
        }

function buyCharacter(event) {
    const selected = event.target.closest('.character-item').getAttribute('data-character');
    const prices = {
character1: 1,   // Default character is free
character2: 25,
character3: 25,
character4: 25,
character5: 25,
character6: 25,
    };

    const selectedPrice = prices[selected];

    if (totalCoinsCollected >= selectedPrice && !purchasedCharacters.includes(selected)) {
        selectedCharacter = selected;
        purchasedCharacters.push(selected);
        totalCoinsCollected -= selectedPrice;
        updateCoinCount();
        updatePurchasedCharacters();
        localStorage.setItem('selectedCharacter', selectedCharacter);
        closeShop();
        alert('Character purchased!');
    } else if (purchasedCharacters.includes(selected)) {
        alert('Character already purchased!');
    } else {
        alert('Not enough coins!');
    }
}

        function selectCharacter(event) {
            const selected = event.target.closest('.character-item').getAttribute('data-character');
            if (purchasedCharacters.includes(selected)) {
                selectedCharacter = selected;
                localStorage.setItem('selectedCharacter', selectedCharacter);
                alert('Character selected!');
                closeSelectCharacter();
            }
        }

        document.getElementById('startButton').addEventListener('click', startGame);
        document.getElementById('shopButton').addEventListener('click', openShop);
        document.getElementById('shopModalClose').addEventListener('click', closeShop);
        document.getElementById('selectCharacterButton').addEventListener('click', openSelectCharacter);
        document.getElementById('selectCharacterModalClose').addEventListener('click', closeSelectCharacter);
        document.getElementById('characters').addEventListener('click', buyCharacter);
        document.getElementById('purchasedCharacters').addEventListener('click', selectCharacter);
        document.addEventListener('keydown', keyDown);
        canvas.addEventListener('touchstart', touchStart);

document.addEventListener('DOMContentLoaded', () => {
    totalCoinsCollected = Number(localStorage.getItem('coins')) || 0;
    purchasedCharacters = JSON.parse(localStorage.getItem('purchasedCharacters')) || [];
    selectedCharacter = localStorage.getItem('selectedCharacter') || 'character1';

 const muteButton = document.getElementById('muteButton');
    if (muteButton) {
        muteButton.addEventListener('click', toggleMute);
    } else {
        console.error('Mute button element not found');
    }

    // Add default character to purchased characters if not already present
    if (!purchasedCharacters.includes('character1')) {
        purchasedCharacters.push('character1');
    }
fetchHighscores();
    updateCoinCount();
    updatePurchasedCharacters();
});

canvas.addEventListener('click', (event) => {
    const username = localStorage.getItem('username');
    if (!username) {
        event.stopPropagation(); // Stop event propagation
        document.getElementById('usernameModal').style.display = 'block';
    }
});
document.getElementById('saveUsernameButton').addEventListener('click', () => {
    const username = document.getElementById('usernameInput').value.trim();
    if (username.length > 12) {
        document.getElementById('usernameValidationMessage').textContent = 'Username must be 12 characters or less.';
    } else if (username) {
        localStorage.setItem('username', username);
        document.getElementById('usernameModal').style.display = 'none';
    } else {
        document.getElementById('usernameValidationMessage').textContent = 'Please enter a valid username.';
    }
});
function updateHighscore() {
    const username = localStorage.getItem('username');
    const highscore = Number(localStorage.getItem('highscore')) || 0;

    if (score > highscore) {
        localStorage.setItem('highscore', score);
        localStorage.setItem('highscoreUsername', username);
    }
}

document.getElementById('highscoreButton').addEventListener('click', () => {
    populateHighscoreList();
    document.getElementById('highscoreModal').style.display = 'block';
});




function populateHighscoreList() {
    const highscore = localStorage.getItem('highscore') || 0;
    const highscoreUsername = localStorage.getItem('highscoreUsername') || 'No one';
    const highscoreList = document.getElementById('highscoreList');
    highscoreList.innerHTML = `<p>Highscore: ${highscore} by ${highscoreUsername}</p>`;
}




function closeHighscoreModal() {
    document.getElementById('highscoreModal').style.display = 'none';
}

document.getElementById('highscoreModalClose').addEventListener('click', closeHighscoreModal);


        turtleImage.onload = function() {
            document.getElementById('startButton').style.display = 'block';
            document.getElementById('shopButton').style.display = 'block';
            document.getElementById('selectCharacterButton').style.display = 'block';
        };
        
        
let isPaused = false;

// Function to toggle pause
function togglePause() {
    if (isPaused) {
        // Resume the game
        isPaused = false;
        gameRunning = true;
        backgroundMusic.play();
        update();
        barCreationInterval = setInterval(createBars, 2000);
        barSpeedIncreaseInterval = setInterval(increaseBarSpeed, 5000);
        speedUpdateInterval = setInterval(updateSpeed, 5000);
        document.getElementById('pauseButton').textContent = 'Pause';
    } else {
        // Pause the game
        isPaused = true;
        gameRunning = false;
        backgroundMusic.pause();
        clearInterval(barCreationInterval);
        clearInterval(barSpeedIncreaseInterval);
        clearInterval(speedUpdateInterval);
        document.getElementById('pauseButton').textContent = 'Resume';
    }
}

// Add event listener for the "P" key to toggle pause
document.addEventListener('keydown', function(event) {
    if (event.key === 'p' || event.key === 'P') {
        togglePause();
    }
});

// Add event listener for the pause button to toggle pause
document.getElementById('pauseButton').addEventListener('click', togglePause);
        
let isMuted = false;

function toggleMute() {
    isMuted = !isMuted;
    
    const audioElements = [coinSound, backgroundMusic, gameOverSound, scoreSound];
    
    audioElements.forEach(audio => {
        audio.muted = isMuted;
    });

    const muteButton = document.getElementById('muteButton');
    muteButton.textContent = isMuted ? 'Unmute' : 'Mute';
}


    </script>
</body>
</html>